<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 2000">
  <!-- Background -->
  <rect x="0" y="0" width="1400" height="2000" fill="#F5F5F5"/>

  <!-- Definitions -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
    <marker id="rabbitmq-arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#FF6600"/>
    </marker>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="700" y="35" text-anchor="middle" font-size="24" font-weight="bold" fill="#1565C0">
    Fleet Management System - 50,000 Toyota BZ3 Taxis
  </text>
  <text x="700" y="60" text-anchor="middle" font-size="14" fill="#666">
    Company-Owned Fleet | Employee Drivers | Vehicle-Centric Architecture
  </text>

  <!-- ========== MOBILE APPS LAYER ========== -->
  <g id="apps-layer">
    <rect x="50" y="90" width="600" height="100" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="8" filter="url(#shadow)"/>
    <text x="350" y="115" text-anchor="middle" font-size="16" font-weight="bold" fill="#0D47A1">üì± Mobile Applications</text>
    
    <rect x="80" y="130" width="160" height="45" fill="#42A5F5" stroke="#1565C0" stroke-width="2" rx="5"/>
    <text x="160" y="150" text-anchor="middle" font-size="13" font-weight="bold" fill="white">Driver App</text>
    <text x="160" y="166" text-anchor="middle" font-size="10" fill="white">Employee Login + Vehicle Assignment</text>
    
    <rect x="270" y="130" width="160" height="45" fill="#42A5F5" stroke="#1565C0" stroke-width="2" rx="5"/>
    <text x="350" y="150" text-anchor="middle" font-size="13" font-weight="bold" fill="white">Passenger App</text>
    <text x="350" y="166" text-anchor="middle" font-size="10" fill="white">Ride Request</text>
    
    <rect x="460" y="130" width="160" height="45" fill="#90CAF9" stroke="#1976D2" stroke-width="2" rx="5"/>
    <text x="540" y="150" text-anchor="middle" font-size="13" font-weight="bold" fill="#0D47A1">Operations Dashboard</text>
    <text x="540" y="166" text-anchor="middle" font-size="10" fill="#1565C0">Fleet Management</text>
  </g>

  <!-- ========== API GATEWAY ========== -->
  <g id="gateway">
    <rect x="50" y="220" width="600" height="80" fill="#F3E5F5" stroke="#6A1B9A" stroke-width="2" rx="8" filter="url(#shadow)"/>
    <text x="350" y="245" text-anchor="middle" font-size="16" font-weight="bold" fill="#4A148C">üõ°Ô∏è API Gateway (Traefik)</text>
    <text x="350" y="265" text-anchor="middle" font-size="11" fill="#6A1B9A">Load Balancer | Auth (Keycloak) | Rate Limiting</text>
    <text x="350" y="285" text-anchor="middle" font-size="10" fill="#9C27B0">All services are STATELESS - state in Redis/PostgreSQL</text>
  </g>

  <!-- ========== MICROSERVICES LAYER ========== -->
  <g id="microservices">
    <rect x="50" y="330" width="1300" height="800" fill="#E8F5E9" stroke="#2E7D32" stroke-width="3" rx="8" filter="url(#shadow)"/>
    <text x="700" y="355" text-anchor="middle" font-size="18" font-weight="bold" fill="#1B5E20">‚öôÔ∏è Microservices Layer (6 Services)</text>

    <!-- Row 1: Core Services -->
    <!-- Vehicle Service -->
    <rect x="80" y="380" width="240" height="140" fill="#00897B" stroke="#00695C" stroke-width="2" rx="5"/>
    <text x="200" y="405" text-anchor="middle" font-size="15" font-weight="bold" fill="white">1. Vehicle Service</text>
    <text x="200" y="425" text-anchor="middle" font-size="11" fill="#B2DFDB">FastAPI + Stateless</text>
    <line x1="85" y1="432" x2="315" y2="432" stroke="#B2DFDB" stroke-width="1"/>
    <text x="95" y="450" font-size="10" fill="white">‚Ä¢ 50K Vehicles Management</text>
    <text x="95" y="465" font-size="10" fill="white">‚Ä¢ Track KM driven (service at 5000km)</text>
    <text x="95" y="480" font-size="10" fill="white">‚Ä¢ Battery level monitoring</text>
    <text x="95" y="495" font-size="10" fill="white">‚Ä¢ Real-time GPS location storage</text>
    <text x="95" y="510" font-size="10" fill="white">‚Ä¢ Maintenance schedule</text>
    <text x="200" y="513" text-anchor="middle" font-size="9" fill="#80CBC4">PostgreSQL + Redis + ScyllaDB</text>

    <!-- Driver Service -->
    <rect x="340" y="380" width="240" height="140" fill="#00897B" stroke="#00695C" stroke-width="2" rx="5"/>
    <text x="460" y="405" text-anchor="middle" font-size="15" font-weight="bold" fill="white">2. Driver Service</text>
    <text x="460" y="425" text-anchor="middle" font-size="11" fill="#B2DFDB">FastAPI + Stateless</text>
    <line x1="345" y1="432" x2="575" y2="432" stroke="#B2DFDB" stroke-width="1"/>
    <text x="355" y="450" font-size="10" fill="white">‚Ä¢ Employee Management</text>
    <text x="355" y="465" font-size="10" fill="white">‚Ä¢ Shift tracking</text>
    <text x="355" y="480" font-size="10" fill="white">‚Ä¢ Vehicle assignment</text>
    <text x="355" y="495" font-size="10" fill="white">‚Ä¢ Performance metrics</text>
    <text x="355" y="510" font-size="10" fill="white">‚Ä¢ Working hours</text>
    <text x="460" y="513" text-anchor="middle" font-size="9" fill="#80CBC4">PostgreSQL</text>

    <!-- Customer Service -->
    <rect x="600" y="380" width="240" height="140" fill="#00897B" stroke="#00695C" stroke-width="2" rx="5"/>
    <text x="720" y="405" text-anchor="middle" font-size="15" font-weight="bold" fill="white">3. Customer Service</text>
    <text x="720" y="425" text-anchor="middle" font-size="11" fill="#B2DFDB">FastAPI + Stateless</text>
    <line x1="605" y1="432" x2="835" y2="432" stroke="#B2DFDB" stroke-width="1"/>
    <text x="615" y="450" font-size="10" fill="white">‚Ä¢ Passenger registration</text>
    <text x="615" y="465" font-size="10" fill="white">‚Ä¢ Ride request creation</text>
    <text x="615" y="480" font-size="10" fill="white">‚Ä¢ Ride history</text>
    <text x="615" y="495" font-size="10" fill="white">‚Ä¢ Customer ratings</text>
    <text x="615" y="510" font-size="10" fill="white">‚Ä¢ Profile management</text>
    <text x="720" y="513" text-anchor="middle" font-size="9" fill="#80CBC4">PostgreSQL</text>

    <!-- MatchEngine Service -->
    <rect x="860" y="380" width="240" height="140" fill="#1976D2" stroke="#0D47A1" stroke-width="2" rx="5"/>
    <text x="980" y="405" text-anchor="middle" font-size="15" font-weight="bold" fill="white">4. MatchEngine</text>
    <text x="980" y="425" text-anchor="middle" font-size="11" fill="#90CAF9">FastAPI + Stateless</text>
    <line x1="865" y1="432" x2="1095" y2="432" stroke="#90CAF9" stroke-width="1"/>
    <text x="875" y="450" font-size="10" fill="white">‚Ä¢ Find best VEHICLE (not driver!)</text>
    <text x="875" y="465" font-size="10" fill="white">‚Ä¢ Check battery level &gt; 30%</text>
    <text x="875" y="480" font-size="10" fill="white">‚Ä¢ Check maintenance status</text>
    <text x="875" y="495" font-size="10" fill="white">‚Ä¢ H3 spatial indexing</text>
    <text x="875" y="510" font-size="10" fill="white">‚Ä¢ Latency: &lt;20ms</text>
    <text x="980" y="513" text-anchor="middle" font-size="9" fill="#BBDEFB">Redis (H3 grid)</text>

    <!-- Row 2: Dispatch Service (MAIN ORCHESTRATOR) -->
    <rect x="80" y="545" width="760" height="180" fill="#D32F2F" stroke="#B71C1C" stroke-width="3" rx="5"/>
    <text x="460" y="575" text-anchor="middle" font-size="16" font-weight="bold" fill="white">5. Dispatch Service (Main Orchestrator)</text>
    <text x="460" y="595" text-anchor="middle" font-size="12" fill="#FFCDD2">FastAPI + Stateless | ALL complex business logic here</text>
    <line x1="85" y1="602" x2="835" y2="602" stroke="#FFCDD2" stroke-width="1"/>
    
    <g id="dispatch-responsibilities">
      <text x="95" y="625" font-size="11" font-weight="bold" fill="#FFCDD2">A. Vehicle Assignment:</text>
      <text x="105" y="642" font-size="10" fill="white">‚Ä¢ Assign vehicle to driver at shift start</text>
      <text x="105" y="657" font-size="10" fill="white">‚Ä¢ Track vehicle availability</text>
      
      <text x="95" y="680" font-size="11" font-weight="bold" fill="#FFCDD2">B. Ride Orchestration:</text>
      <text x="105" y="697" font-size="10" fill="white">‚Ä¢ Receive ‚Üí MatchEngine ‚Üí Find vehicle</text>
      <text x="105" y="712" font-size="10" fill="white">‚Ä¢ Notify ‚Üí Track ‚Üí Start trip ‚Üí Complete</text>
      
      <text x="450" y="625" font-size="11" font-weight="bold" fill="#FFCDD2">C. Fleet Maintenance:</text>
      <text x="460" y="642" font-size="10" fill="white">‚Ä¢ Track KM (all 50K vehicles)</text>
      <text x="460" y="657" font-size="10" fill="white">‚Ä¢ Alert at 5000 km intervals</text>
      <text x="460" y="672" font-size="10" fill="white">‚Ä¢ Schedule maintenance</text>
      <text x="460" y="687" font-size="10" fill="white">‚Ä¢ Mark unavailable</text>
      
      <text x="450" y="702" font-size="11" font-weight="bold" fill="#FFCDD2">D. Battery Management:</text>
      <text x="460" y="715" font-size="10" fill="white">‚Ä¢ Monitor real-time | Route to charging</text>
    </g>
    <text x="460" y="718" text-anchor="middle" font-size="9" fill="#FFAB91">Redis (temp) + PostgreSQL (permanent)</text>

    <!-- LocationFusion Service (NEW - 6th Service!) -->
    <rect x="860" y="545" width="240" height="180" fill="#9C27B0" stroke="#6A1B9A" stroke-width="3" rx="5"/>
    <text x="980" y="575" text-anchor="middle" font-size="15" font-weight="bold" fill="white">6. LocationFusion</text>
    <text x="980" y="595" text-anchor="middle" font-size="11" fill="#E1BEE7">FastAPI + Stateless</text>
    <line x1="865" y1="602" x2="1095" y2="602" stroke="#E1BEE7" stroke-width="1"/>
    <text x="875" y="622" font-size="10" fill="white">12 Location Methods:</text>
    <text x="875" y="637" font-size="9" fill="white">MVP: 7 backend methods</text>
    <text x="875" y="650" font-size="9" fill="white">‚Ä¢ GPS/GNSS + validation</text>
    <text x="875" y="663" font-size="9" fill="white">‚Ä¢ Cellular Triangulation</text>
    <text x="875" y="676" font-size="9" fill="white">‚Ä¢ WiFi Triangulation</text>
    <text x="875" y="689" font-size="9" fill="white">‚Ä¢ Map Matching (H3)</text>
    <text x="875" y="702" font-size="9" fill="white">‚Ä¢ V2V Cooperative</text>
    <text x="875" y="715" font-size="9" fill="white">Kalman Filter Fusion</text>
    <text x="980" y="718" text-anchor="middle" font-size="9" fill="#CE93D8">Redis + PostgreSQL</text>

    <!-- Existing Services (Integrations) -->
    <rect x="1120" y="380" width="210" height="130" fill="#FF6F00" stroke="#E65100" stroke-width="2" rx="5"/>
    <text x="1225" y="405" text-anchor="middle" font-size="15" font-weight="bold" fill="white">Payment Service</text>
    <text x="1225" y="425" text-anchor="middle" font-size="11" fill="#FFE0B2">ALREADY EXISTS ‚úÖ</text>
    <line x1="1125" y1="432" x2="1325" y2="432" stroke="#FFE0B2" stroke-width="1"/>
    <text x="1135" y="450" font-size="10" fill="white">‚Ä¢ Process ride payments</text>
    <text x="1135" y="465" font-size="10" fill="white">‚Ä¢ Driver salary calculation</text>
    <text x="1135" y="480" font-size="10" fill="white">‚Ä¢ Surge pricing</text>
    <text x="1135" y="495" font-size="10" fill="white">‚Ä¢ Wallet management</text>
    <text x="1225" y="503" text-anchor="middle" font-size="9" fill="#FFCC80">Integration: RabbitMQ</text>
    
    <rect x="1120" y="530" width="210" height="110" fill="#FF6F00" stroke="#E65100" stroke-width="2" rx="5"/>
    <text x="1225" y="555" text-anchor="middle" font-size="15" font-weight="bold" fill="white">Notification Service</text>
    <text x="1225" y="575" text-anchor="middle" font-size="11" fill="#FFE0B2">ALREADY EXISTS ‚úÖ</text>
    <line x1="1125" y1="582" x2="1325" y2="582" stroke="#FFE0B2" stroke-width="1"/>
    <text x="1135" y="600" font-size="10" fill="white">‚Ä¢ SMS / Push / USSD</text>
    <text x="1135" y="615" font-size="10" fill="white">‚Ä¢ Driver notifications</text>
    <text x="1135" y="630" font-size="10" fill="white">‚Ä¢ Maintenance alerts</text>
    <text x="1225" y="633" text-anchor="middle" font-size="9" fill="#FFCC80">Integration: RabbitMQ</text>

    <!-- RabbitMQ -->
    <rect x="80" y="750" width="1020" height="90" fill="#FF6600" stroke="#CC5200" stroke-width="2" rx="5"/>
    <text x="590" y="775" text-anchor="middle" font-size="15" font-weight="bold" fill="white">üì® RabbitMQ (Message Queue)</text>
    <line x1="85" y1="782" x2="1095" y2="782" stroke="#FFE0B2" stroke-width="1"/>
    <text x="95" y="800" font-size="10" fill="white">Events:</text>
    <text x="95" y="815" font-size="10" fill="white">‚Ä¢ ride.completed ‚Üí Payment | ‚Ä¢ maintenance.due ‚Üí Notification | ‚Ä¢ battery.low ‚Üí Notification</text>
    <text x="95" y="830" font-size="10" fill="white">‚Ä¢ vehicle.needs_service ‚Üí Operations | ‚Ä¢ charging.needed ‚Üí Driver</text>

    <!-- Location Flow Explanation -->
    <rect x="80" y="860" width="1020" height="110" fill="#E1BEE7" stroke="#6A1B9A" stroke-width="2" rx="5"/>
    <text x="590" y="885" text-anchor="middle" font-size="14" font-weight="bold" fill="#4A148C">üìç Location Processing Flow</text>
    <line x1="85" y1="892" x2="1095" y2="892" stroke="#9C27B0" stroke-width="1"/>
    <text x="95" y="910" font-size="10" fill="#333">1. Vehicle T-Box sends: GPS + Speed + Heading + Battery ‚Üí LocationFusion Service</text>
    <text x="95" y="925" font-size="10" fill="#333">2. LocationFusion runs 7 methods + Kalman Filter fusion ‚Üí Final location (lat, lon, accuracy)</text>
    <text x="95" y="940" font-size="10" fill="#333">3. LocationFusion ‚Üí Vehicle Service ‚Üí Store in Redis (real-time) + ScyllaDB (history)</text>
    <text x="95" y="955" font-size="10" fill="#333">4. MatchEngine reads from Redis for geospatial queries (H3 grid, &lt;20ms)</text>
    <text x="590" y="963" text-anchor="middle" font-size="9" fill="#9C27B0">Result: 2-10m accuracy, 98% uptime (even during GPS jamming)</text>
  </g>

  <!-- ========== STORAGE LAYER ========== -->
  <g id="storage">
    <rect x="50" y="1160" width="1300" height="200" fill="#FFF3E0" stroke="#F57F17" stroke-width="3" rx="8" filter="url(#shadow)"/>
    <text x="700" y="1185" text-anchor="middle" font-size="18" font-weight="bold" fill="#F57F17">üíæ Storage Layer (Stateless Design)</text>
    
    <!-- PostgreSQL -->
    <rect x="80" y="1205" width="280" height="135" fill="#336791" stroke="#23527C" stroke-width="2" rx="5"/>
    <text x="220" y="1230" text-anchor="middle" font-size="14" font-weight="bold" fill="white">PostgreSQL (Main DB)</text>
    <line x1="85" y1="1237" x2="355" y2="1237" stroke="#A8C8E4" stroke-width="1"/>
    <text x="95" y="1255" font-size="10" fill="white">Tables:</text>
    <text x="95" y="1270" font-size="10" fill="white">‚Ä¢ vehicles (50K records)</text>
    <text x="95" y="1285" font-size="10" fill="white">‚Ä¢ drivers (employee data)</text>
    <text x="95" y="1300" font-size="10" fill="white">‚Ä¢ customers</text>
    <text x="95" y="1315" font-size="10" fill="white">‚Ä¢ rides (history)</text>
    <text x="95" y="1330" font-size="10" fill="white">‚Ä¢ maintenance_schedule</text>

    <!-- Redis -->
    <rect x="380" y="1205" width="280" height="135" fill="#DC382D" stroke="#A41E11" stroke-width="2" rx="5"/>
    <text x="520" y="1230" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Redis Cluster</text>
    <line x1="385" y1="1237" x2="655" y2="1237" stroke="#F8C9C4" stroke-width="1"/>
    <text x="395" y="1255" font-size="10" fill="white">Cached Data (Temporary):</text>
    <text x="395" y="1270" font-size="10" fill="white">‚Ä¢ Vehicle locations (H3 grid)</text>
    <text x="395" y="1285" font-size="10" fill="white">‚Ä¢ Current battery levels</text>
    <text x="395" y="1300" font-size="10" fill="white">‚Ä¢ Active ride states</text>
    <text x="395" y="1315" font-size="10" fill="white">‚Ä¢ Driver availability</text>
    <text x="395" y="1330" font-size="10" fill="white">‚Ä¢ Geospatial queries</text>

    <!-- ScyllaDB -->
    <rect x="680" y="1205" width="280" height="135" fill="#00BCD4" stroke="#0097A7" stroke-width="2" rx="5"/>
    <text x="820" y="1230" text-anchor="middle" font-size="14" font-weight="bold" fill="white">ScyllaDB (Time-Series)</text>
    <line x1="685" y1="1237" x2="955" y2="1237" stroke="#B2EBF2" stroke-width="1"/>
    <text x="695" y="1255" font-size="10" fill="white">High-Write Data:</text>
    <text x="695" y="1270" font-size="10" fill="white">‚Ä¢ GPS tracking (real-time)</text>
    <text x="695" y="1285" font-size="10" fill="white">‚Ä¢ Vehicle telemetry</text>
    <text x="695" y="1300" font-size="10" fill="white">‚Ä¢ Battery history</text>
    <text x="695" y="1315" font-size="10" fill="white">‚Ä¢ Trip waypoints</text>
    <text x="695" y="1330" font-size="10" fill="white">‚Ä¢ Performance metrics</text>

    <!-- Cassandra -->
    <rect x="980" y="1205" width="280" height="135" fill="#1287B1" stroke="#0E6A8F" stroke-width="2" rx="5"/>
    <text x="1120" y="1230" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Cassandra</text>
    <line x1="985" y1="1237" x2="1255" y2="1237" stroke="#A3D9E8" stroke-width="1"/>
    <text x="995" y="1255" font-size="10" fill="white">Vehicle Analytics:</text>
    <text x="995" y="1270" font-size="10" fill="white">‚Ä¢ Battery degradation data</text>
    <text x="995" y="1285" font-size="10" fill="white">‚Ä¢ Maintenance logs</text>
    <text x="995" y="1300" font-size="10" fill="white">‚Ä¢ Equipment wear patterns</text>
    <text x="995" y="1315" font-size="10" fill="white">‚Ä¢ Long-term telemetry</text>
    <text x="995" y="1330" font-size="10" fill="white">‚Ä¢ Predictive maintenance</text>
  </g>

  <!-- ========== KEY FEATURES ========== -->
  <g id="key-features">
    <rect x="50" y="1390" width="1300" height="140" fill="#E8EAF6" stroke="#3F51B5" stroke-width="2" rx="8" filter="url(#shadow)"/>
    <text x="700" y="1415" text-anchor="middle" font-size="18" font-weight="bold" fill="#1A237E">üéØ Key System Features</text>
    
    <g id="features-list">
      <text x="80" y="1445" font-size="12" font-weight="bold" fill="#3F51B5">Vehicle-Centric Design:</text>
      <text x="90" y="1465" font-size="11" fill="#333">‚úì System tracks VEHICLES (not drivers)</text>
      <text x="90" y="1482" font-size="11" fill="#333">‚úì Drivers assigned to vehicles at shift</text>
      <text x="90" y="1499" font-size="11" fill="#333">‚úì KM tracking: Alert at 5000km intervals</text>
      <text x="90" y="1516" font-size="11" fill="#333">‚úì Automated maintenance scheduling</text>
      
      <text x="450" y="1445" font-size="12" font-weight="bold" fill="#3F51B5">Stateless Architecture:</text>
      <text x="460" y="1465" font-size="11" fill="#333">‚úì All 6 services scale horizontally</text>
      <text x="460" y="1482" font-size="11" fill="#333">‚úì State in Redis/PostgreSQL</text>
      <text x="460" y="1499" font-size="11" fill="#333">‚úì Zero-downtime deployments</text>
      <text x="460" y="1516" font-size="11" fill="#333">‚úì Load balancing across instances</text>
      
      <text x="800" y="1445" font-size="12" font-weight="bold" fill="#3F51B5">Location Fusion (12 Methods):</text>
      <text x="810" y="1465" font-size="11" fill="#333">‚úì Combat GPS jamming/spoofing</text>
      <text x="810" y="1482" font-size="11" fill="#333">‚úì 2-10m accuracy, 98% uptime</text>
      <text x="810" y="1499" font-size="11" fill="#333">‚úì Kalman Filter fusion</text>
      <text x="810" y="1516" font-size="11" fill="#333">‚úì Dynamic trust scoring</text>
      
      <text x="1100" y="1445" font-size="12" font-weight="bold" fill="#3F51B5">Integration:</text>
      <text x="1110" y="1465" font-size="11" fill="#333">‚úì Payment via RabbitMQ</text>
      <text x="1110" y="1482" font-size="11" fill="#333">‚úì Notifications via RabbitMQ</text>
      <text x="1110" y="1499" font-size="11" fill="#333">‚úì Event-driven architecture</text>
      <text x="1110" y="1516" font-size="11" fill="#333">‚úì Async processing</text>
    </g>
  </g>

  <!-- ========== DATA FLOW EXAMPLE ========== -->
  <g id="dataflow">
    <rect x="50" y="1560" width="1300" height="400" fill="#FFF8E1" stroke="#F57F17" stroke-width="2" rx="8" filter="url(#shadow)"/>
    <text x="700" y="1585" text-anchor="middle" font-size="18" font-weight="bold" fill="#F57F17">üîÑ Complete Ride Flow Example</text>
    
    <g id="flow-steps">
      <!-- Step 1 -->
      <rect x="80" y="1605" width="240" height="60" fill="#4CAF50" stroke="#388E3C" stroke-width="2" rx="5"/>
      <text x="200" y="1625" text-anchor="middle" font-size="12" font-weight="bold" fill="white">1. Request Ride</text>
      <text x="90" y="1645" font-size="10" fill="white">Customer Service</text>
      <text x="90" y="1660" font-size="10" fill="white">‚Üí Dispatch Service</text>
      
      <line x1="320" y1="1635" x2="350" y2="1635" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      
      <!-- Step 2 -->
      <rect x="350" y="1605" width="240" height="60" fill="#2196F3" stroke="#1976D2" stroke-width="2" rx="5"/>
      <text x="470" y="1625" text-anchor="middle" font-size="12" font-weight="bold" fill="white">2. Find Vehicle</text>
      <text x="360" y="1645" font-size="10" fill="white">Dispatch ‚Üí MatchEngine</text>
      <text x="360" y="1660" font-size="10" fill="white">battery &gt; 30%, no maint.</text>
      
      <line x1="590" y1="1635" x2="620" y2="1635" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      
      <!-- Step 3 -->
      <rect x="620" y="1605" width="240" height="60" fill="#FF9800" stroke="#F57C00" stroke-width="2" rx="5"/>
      <text x="740" y="1625" text-anchor="middle" font-size="12" font-weight="bold" fill="white">3. Notify Driver</text>
      <text x="630" y="1645" font-size="10" fill="white">Dispatch ‚Üí RabbitMQ</text>
      <text x="630" y="1660" font-size="10" fill="white">‚Üí Notification</text>
      
      <line x1="860" y1="1635" x2="890" y2="1635" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      
      <!-- Step 4 -->
      <rect x="890" y="1605" width="240" height="60" fill="#9C27B0" stroke="#7B1FA2" stroke-width="2" rx="5"/>
      <text x="1010" y="1625" text-anchor="middle" font-size="12" font-weight="bold" fill="white">4. Accept</text>
      <text x="900" y="1645" font-size="10" fill="white">Update in Redis</text>
      <text x="900" y="1660" font-size="10" fill="white">Start trip tracking</text>

      <!-- Step 5 -->
      <rect x="80" y="1690" width="240" height="60" fill="#00BCD4" stroke="#0097A7" stroke-width="2" rx="5"/>
      <text x="200" y="1710" text-anchor="middle" font-size="12" font-weight="bold" fill="white">5. Trip Progress</text>
      <text x="90" y="1730" font-size="10" fill="white">GPS tracking</text>
      <text x="90" y="1745" font-size="10" fill="white">Monitor battery</text>
      
      <line x1="320" y1="1720" x2="350" y2="1720" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      
      <!-- Step 6 -->
      <rect x="350" y="1690" width="240" height="60" fill="#4CAF50" stroke="#388E3C" stroke-width="2" rx="5"/>
      <text x="470" y="1710" text-anchor="middle" font-size="12" font-weight="bold" fill="white">6. Complete Ride</text>
      <text x="360" y="1730" font-size="10" fill="white">Update vehicle KM</text>
      <text x="360" y="1745" font-size="10" fill="white">Check: KM % 5000</text>
      
      <line x1="590" y1="1720" x2="620" y2="1720" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      
      <!-- Step 7 -->
      <rect x="620" y="1690" width="240" height="60" fill="#FF5722" stroke="#D84315" stroke-width="2" rx="5"/>
      <text x="740" y="1710" text-anchor="middle" font-size="12" font-weight="bold" fill="white">7. Payment</text>
      <text x="630" y="1730" font-size="10" fill="white">Dispatch ‚Üí RabbitMQ</text>
      <text x="630" y="1745" font-size="10" fill="white">‚Üí Payment Service</text>
      
      <line x1="860" y1="1720" x2="890" y2="1720" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      
      <!-- Step 8 -->
      <rect x="890" y="1690" width="240" height="60" fill="#795548" stroke="#5D4037" stroke-width="2" rx="5"/>
      <text x="1010" y="1710" text-anchor="middle" font-size="12" font-weight="bold" fill="white">8. Maintenance?</text>
      <text x="900" y="1730" font-size="10" fill="white">If KM = 5000 interval</text>
      <text x="900" y="1745" font-size="10" fill="white">Send notification</text>

      <!-- Alert Examples -->
      <rect x="80" y="1775" width="530" height="85" fill="#FFEBEE" stroke="#C62828" stroke-width="2" rx="5"/>
      <text x="345" y="1795" text-anchor="middle" font-size="12" font-weight="bold" fill="#C62828">üîß Maintenance Alert</text>
      <text x="90" y="1815" font-size="10" fill="#333">Vehicle ABC-123 reached 5,000 km</text>
      <text x="90" y="1830" font-size="10" fill="#333">‚Üí Mark "Needs Service"</text>
      <text x="90" y="1845" font-size="10" fill="#333">‚Üí Notify: Driver + Operations + Maintenance</text>
      
      <rect x="630" y="1775" width="500" height="85" fill="#E8F5E9" stroke="#2E7D32" stroke-width="2" rx="5"/>
      <text x="880" y="1795" text-anchor="middle" font-size="12" font-weight="bold" fill="#2E7D32">üîã Battery Alert</text>
      <text x="640" y="1815" font-size="10" fill="#333">Vehicle XYZ-789 battery = 25%</text>
      <text x="640" y="1830" font-size="10" fill="#333">‚Üí Route to charging station</text>
      <text x="640" y="1845" font-size="10" fill="#333">‚Üí Mark unavailable until charged &gt; 50%</text>
      
      <!-- Location Example -->
      <rect x="80" y="1880" width="1050" height="65" fill="#E1BEE7" stroke="#6A1B9A" stroke-width="2" rx="5"/>
      <text x="605" y="1900" text-anchor="middle" font-size="12" font-weight="bold" fill="#4A148C">üìç Location Processing</text>
      <text x="90" y="1920" font-size="10" fill="#333">Vehicle T-Box ‚Üí LocationFusion (runs 7 methods + Kalman Filter) ‚Üí Vehicle Service (store Redis + ScyllaDB)</text>
      <text x="90" y="1935" font-size="10" fill="#333">Result: Final location with 2-10m accuracy, even during GPS jamming</text>
    </g>
  </g>

  <!-- ========== CONNECTIONS ========== -->
  <!-- Apps to Gateway -->
  <line x1="350" y1="190" x2="350" y2="220" stroke="#1976D2" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Gateway to Services -->
  <line x1="350" y1="300" x2="200" y2="380" stroke="#1976D2" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="350" y1="300" x2="460" y2="380" stroke="#1976D2" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="350" y1="300" x2="720" y2="380" stroke="#1976D2" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Services to Dispatch -->
  <line x1="200" y1="520" x2="460" y2="545" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="460" y1="520" x2="460" y2="545" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="720" y1="520" x2="460" y2="545" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="980" y1="520" x2="460" y2="545" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- LocationFusion to Vehicle Service -->
  <line x1="860" y1="635" x2="320" y2="520" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="590" y="575" font-size="9" fill="#9C27B0">Final location</text>
  
  <!-- Dispatch to RabbitMQ -->
  <line x1="460" y1="725" x2="590" y2="750" stroke="#FF6600" stroke-width="3" marker-end="url(#rabbitmq-arrow)"/>
  
  <!-- RabbitMQ to Payment/Notification -->
  <line x1="1100" y1="795" x2="1225" y2="510" stroke="#FF6600" stroke-width="2" marker-end="url(#rabbitmq-arrow)"/>
  <line x1="1100" y1="795" x2="1225" y2="640" stroke="#FF6600" stroke-width="2" marker-end="url(#rabbitmq-arrow)"/>
  
  <!-- Services to Storage -->
  <line x1="220" y1="520" x2="220" y2="1205" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="520" y1="520" x2="520" y2="1205" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="820" y1="520" x2="820" y2="1205" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
</svg>